<html lang="en">
    <head>
        <script src="https://cdn.observableusercontent.com/npm/d3@7.6.1/dist/d3.min.js"></script>
        <script src="https://cdn.observableusercontent.com/npm/marked@0.3.12/marked.min.js"></script>
        <script src="https://cdn.observableusercontent.com/npm/htl@0.3.1/dist/htl.min.js"></script>
        <script src="https://cdn.observableusercontent.com/npm/@observablehq/highlight.js@2.0.0/highlight.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script src="https://dvmorozov.github.io/arxiv/ArxivNavigator/data/topics.js" charset="utf-8"></script>
        <script src="https://dvmorozov.github.io/arxiv/ArxivNavigator/graphs/force-graph.js" charset="utf-8"></script>
        <link rel="shortcut icon" href="https://dvmorozov.github.io/arxiv/ArxivNavigator/graphs/favicon.ico">
        <link rel="stylesheet" href="https://dvmorozov.github.io/arxiv/ArxivNavigator/graphs/main.css">

        <script language="JavaScript">
            var parentDestination = null;

            function isDefined(obj) {
                if (obj !== undefined && obj !== null) return true;
                else return false;
            }

            function updateParentSize() {
                //  Send message with size to parent window.
                if (isDefined(parentDestination)) {
                    window.parent.postMessage({ height: document.body.scrollHeight, width: document.body.scrollWidth },
                        parentDestination);
                }
            }

            (function () {
                var parentEventHandler = function (event) {
                    //  Handles messages from parent window.
                    //	Destination should not be empty string.
                    if (isDefined(event.data) &&
                       (event.data.search("http://") != -1 || event.data.search("https://") != -1)) {
                        parentDestination = event.data;
                        updateParentSize();
                    }
                    else
                        parentDestination = null;
                };
                window.addEventListener('message', parentEventHandler, false);
            })();
        </script>
    </head>

    <body>
        <svg id="visualisation"></svg>

        <script language="JavaScript">
            const graphWidth = 800;
            const graphHeight = 600;

            $('svg#visualisation').width(graphWidth);
            $('svg#visualisation').height(graphHeight);

            chart = ForceGraph(topics, {
                nodeGroup: d => d.group,
                //nodeStrength: -200,                       //  This could be a number.
                                                            //  Negative value means repulsion, positive - attraction.
                nodeTitle: d => `${d.id}\n${d.group}`,
                //linkStroke,                               //  Function or value providing stroke value.
                //linkStrokeWidth: 2,
                //nodeRadius: 5,
                width: graphWidth,
                height: graphHeight,
                invalidation: null,                         // a promise to stop the simulation when the cell is re-run
                graphTitle: "Arxiv.org topics by number of articles"
            });

            document.getElementById('visualisation').appendChild(chart);
        </script>
    </body>
</html>